# BOOM Card Backend API - Production Environment Configuration
# Copy this file to .env.production and fill in your production values
# IMPORTANT: Never commit .env.production to version control!

# ============================================
# Node Environment
# ============================================
NODE_ENV=production
PORT=3001

# ============================================
# Database Configuration
# ============================================
# PostgreSQL Production Database
# Replace with your actual production database URL
# Examples:
#   Railway: postgresql://postgres:password@containers-us-west-123.railway.app:5432/railway
#   Supabase: postgresql://postgres:password@db.xxxxxxxxxxxxx.supabase.co:5432/postgres
#   AWS RDS: postgresql://admin:password@boomcard-db.xxxxx.us-east-1.rds.amazonaws.com:5432/boomcard
DATABASE_URL=postgresql://user:password@host:5432/boomcard_production?sslmode=require

# Connection pool settings (adjust based on your hosting plan)
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10
DATABASE_POOL_TIMEOUT=20

# ============================================
# JWT & Authentication Secrets
# ============================================
# CRITICAL: Generate new secrets using: node -e "console.log(require('crypto').randomBytes(64).toString('base64'))"
# DO NOT use the example values below - generate your own!

# JWT Access Token Secret (expires in 1 hour)
JWT_SECRET=REPLACE_WITH_SECURE_64_BYTE_BASE64_SECRET

# Refresh Token Secret (expires in 7 days)
REFRESH_TOKEN_SECRET=REPLACE_WITH_DIFFERENT_64_BYTE_BASE64_SECRET

# Session Secret
SESSION_SECRET=REPLACE_WITH_ANOTHER_64_BYTE_BASE64_SECRET

# Token Expiration Times
ACCESS_TOKEN_EXPIRY=1h
REFRESH_TOKEN_EXPIRY=7d

# ============================================
# CORS Configuration
# ============================================
# Your production frontend URL(s) - comma separated for multiple origins
CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com
# For mobile app, add: https://app.yourdomain.com

# Allow credentials (cookies, authorization headers)
CORS_CREDENTIALS=true

# ============================================
# Rate Limiting
# ============================================
# Global rate limit (requests per window)
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Auth endpoints rate limit (more restrictive)
AUTH_RATE_LIMIT_WINDOW_MS=900000
AUTH_RATE_LIMIT_MAX_REQUESTS=5

# API endpoints rate limit
API_RATE_LIMIT_WINDOW_MS=60000
API_RATE_LIMIT_MAX_REQUESTS=30

# ============================================
# Stripe Payment Configuration
# ============================================
# Get from: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY=sk_live_REPLACE_WITH_YOUR_LIVE_KEY
STRIPE_PUBLIC_KEY=pk_live_REPLACE_WITH_YOUR_LIVE_KEY
STRIPE_WEBHOOK_SECRET=whsec_REPLACE_WITH_YOUR_WEBHOOK_SECRET

# Stripe API Version
STRIPE_API_VERSION=2023-10-16

# ============================================
# Email Service (Optional - for notifications)
# ============================================
# SendGrid
SENDGRID_API_KEY=SG.REPLACE_WITH_YOUR_KEY
FROM_EMAIL=noreply@yourdomain.com

# Or Mailgun
# MAILGUN_API_KEY=your-api-key
# MAILGUN_DOMAIN=mg.yourdomain.com

# ============================================
# Cloud Storage (S3/CloudFlare R2)
# ============================================
# AWS S3
AWS_ACCESS_KEY_ID=REPLACE_WITH_YOUR_KEY
AWS_SECRET_ACCESS_KEY=REPLACE_WITH_YOUR_SECRET
AWS_REGION=us-east-1
AWS_S3_BUCKET=boomcard-receipts-production

# Or CloudFlare R2
# R2_ACCOUNT_ID=your-account-id
# R2_ACCESS_KEY_ID=your-access-key
# R2_SECRET_ACCESS_KEY=your-secret
# R2_BUCKET=boomcard-receipts

# ============================================
# Redis (Optional - for caching and sessions)
# ============================================
REDIS_URL=redis://default:password@host:6379
# Or for Redis Cloud: redis://default:password@redis-12345.c1.us-east-1-2.ec2.cloud.redislabs.com:12345

# ============================================
# Logging & Monitoring
# ============================================
# Log Level: error, warn, info, debug
LOG_LEVEL=info

# Sentry (Error Tracking)
SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/0

# Sentry Environment
SENTRY_ENVIRONMENT=production

# ============================================
# Security Headers
# ============================================
# Content Security Policy
CSP_REPORT_URI=https://yourdomain.com/api/csp-report

# Allowed domains for embedding
ALLOWED_FRAME_ANCESTORS=https://yourdomain.com

# ============================================
# Feature Flags
# ============================================
ENABLE_SWAGGER=false
ENABLE_DEBUG_ROUTES=false
ENABLE_METRICS_ENDPOINT=true

# ============================================
# OCR & Receipt Processing
# ============================================
# Max receipt image size (in bytes)
MAX_RECEIPT_SIZE=5242880

# OCR confidence threshold (0-100)
MIN_OCR_CONFIDENCE=30

# Fraud detection threshold
FRAUD_SCORE_AUTO_APPROVE=30
FRAUD_SCORE_AUTO_REJECT=70

# ============================================
# Cashback Configuration
# ============================================
# Default cashback percentage
DEFAULT_CASHBACK_PERCENT=5.0

# Premium card bonus
PREMIUM_CARD_BONUS=2.0

# Platinum card bonus
PLATINUM_CARD_BONUS=5.0

# Minimum bill amount for cashback
MIN_BILL_AMOUNT=10.0

# ============================================
# Business Rules
# ============================================
# Max scans per day per user
MAX_SCANS_PER_DAY=3

# Max scans per month per user
MAX_SCANS_PER_MONTH=30

# Receipt expiration days (how old receipts are accepted)
RECEIPT_MAX_AGE_DAYS=7

# ============================================
# API Keys (for integrations)
# ============================================
# Google Maps API (for venue location)
GOOGLE_MAPS_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# SMS Provider (Twilio)
TWILIO_ACCOUNT_SID=ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
TWILIO_AUTH_TOKEN=your_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# ============================================
# Mobile App Configuration
# ============================================
# Deep linking scheme
MOBILE_APP_SCHEME=boomcard://

# App Store URLs
IOS_APP_URL=https://apps.apple.com/app/boomcard/id123456789
ANDROID_APP_URL=https://play.google.com/store/apps/details?id=com.boomcard.app

# ============================================
# Admin Panel
# ============================================
# Admin dashboard URL
ADMIN_DASHBOARD_URL=https://admin.yourdomain.com

# Admin API key (for automated tasks)
ADMIN_API_KEY=REPLACE_WITH_SECURE_RANDOM_KEY

# ============================================
# Backup & Maintenance
# ============================================
# Maintenance mode
MAINTENANCE_MODE=false

# Backup schedule (cron format)
BACKUP_SCHEDULE=0 2 * * *

# ============================================
# Analytics & Tracking
# ============================================
# Google Analytics
GA_TRACKING_ID=G-XXXXXXXXXX

# Mixpanel
MIXPANEL_TOKEN=your_token_here

# ============================================
# Production Optimizations
# ============================================
# Enable compression
COMPRESSION_ENABLED=true

# Trust proxy (if behind nginx/cloudflare)
TRUST_PROXY=true

# Keep-alive timeout
KEEP_ALIVE_TIMEOUT=65000

# Headers timeout
HEADERS_TIMEOUT=66000

# ============================================
# Health Check Configuration
# ============================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

# ============================================
# Notes
# ============================================
# 1. All SECRET values must be replaced with secure random strings
# 2. Use different secrets for different environments (dev, staging, prod)
# 3. Rotate secrets regularly (every 90 days recommended)
# 4. Never commit this file with real values to git
# 5. Store secrets in a secure vault (AWS Secrets Manager, 1Password, etc.)
# 6. Use environment-specific values (don't reuse dev secrets in prod)
# 7. Enable 2FA for all critical service accounts (Stripe, AWS, etc.)
